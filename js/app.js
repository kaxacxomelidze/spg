const translations = {
  en: {
    nav: {
      home: "Home",
      news: "News",
      about: "About us",
      aboutHistory: "History",
      aboutMission: "Mission",
      aboutVision: "Vision",
      aboutStructure: "Structure",
      aboutCareer: "Career growth plan",
      aboutMessage: "Director's message",
      team: "Team",
      teamPr: "PR & Event",
      teamAparati: "Administration",
      teamParlament: "Student parliament",
      teamGov: "Student government",
      contact: "Contact",
    },
    topbar: {
      phone: "ðŸ“ž +995 591 037 047",
      email: "âœ‰ï¸ info@spg.ge",
      address: "ðŸ“ 35-37 Zhiuli Shartava St, Tbilisi",
    },
    header: {
      signin: "ðŸ” Sign in",
      contactCta: "Contact us",
      registerCta: "Register",
    },
    hero: {
      tag: "New updates",
      title: "Build your service portal in minutes.",
      subtitle:
        "Manage announcements, publish posts, and keep your team aligned with a bilingual experience tailored for your community.",
      cta: "Explore updates",
      cardTitle: "Latest activity",
      cardBody:
        "Admins can add posts and manage leadership updates directly from the admin dashboard.",
      adminsLabel: "Active admins",
    },
    posts: {
      title: "Recent posts",
    },
    footer: {
      description: "A modern hub for your service portal, connecting teams with clear updates.",
      company: "Company",
      about: "About",
      careers: "Careers",
      press: "Press",
      resources: "Resources",
      blog: "Blog",
      guides: "Guides",
      support: "Support",
      legal: "Legal",
      privacy: "Privacy",
      terms: "Terms",
      security: "Security",
      copy: "Â© 2024 SPG Portal. All rights reserved.",
      contact: "hello@spg-portal.com",
    },
    adminList: {
      title: "Current admins",
      empty: "No admins yet. Add one in the admin console.",
    },
    postsList: {
      empty: "No posts published yet.",
    },
    meta: {
      addedOn: "Added on",
      postedOn: "Posted on",
    },
  },
  ka: {
    nav: {
      home: "áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜",
      news: "áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜",
      about: "áƒ©áƒ•áƒ”áƒœáƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘",
      aboutHistory: "áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ",
      aboutMission: "áƒ›áƒ˜áƒ¡áƒ˜áƒ",
      aboutVision: "áƒ®áƒ”áƒ“áƒ•áƒ",
      aboutStructure: "áƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒ",
      aboutCareer: "áƒ™áƒáƒ áƒ˜áƒ”áƒ áƒ£áƒšáƒ˜ áƒ’áƒáƒœáƒ•áƒ˜áƒ—áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒ”áƒ’áƒ›áƒ",
      aboutMessage: "áƒ®áƒ”áƒšáƒ›áƒ«áƒ¦áƒ•áƒáƒœáƒ”áƒšáƒ˜áƒ¡ áƒ›áƒ˜áƒ›áƒáƒ áƒ—áƒ•áƒ",
      team: "áƒ’áƒ£áƒœáƒ“áƒ˜",
      teamPr: "PR & EVENT",
      teamAparati: "áƒáƒžáƒáƒ áƒáƒ¢áƒ˜",
      teamParlament: "áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ£áƒ áƒ˜ áƒžáƒáƒ áƒšáƒáƒ›áƒ”áƒœáƒ¢áƒ˜",
      teamGov: "áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ£áƒ áƒ˜ áƒ›áƒ—áƒáƒ•áƒ áƒáƒ‘áƒ",
      contact: "áƒ™áƒáƒœáƒ¢áƒáƒ¥áƒ¢áƒ˜",
    },
    topbar: {
      phone: "ðŸ“ž +995 591 037 047",
      email: "âœ‰ï¸ info@spg.ge",
      address: "ðŸ“ áƒŸáƒ˜áƒ£áƒš áƒ¨áƒáƒ áƒ¢áƒáƒ•áƒáƒ¡ 35-37, áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜",
    },
    header: {
      signin: "ðŸ” Sign in",
      contactCta: "áƒ›áƒáƒ’áƒ•áƒ¬áƒ”áƒ áƒ”",
      registerCta: "áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ",
    },
    hero: {
      tag: "áƒáƒ®áƒáƒšáƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜",
      title: "áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡ áƒžáƒáƒ áƒ¢áƒáƒšáƒ˜ áƒ áƒáƒ›áƒ“áƒ”áƒœáƒ˜áƒ›áƒ” áƒ¬áƒ£áƒ—áƒ¨áƒ˜.",
      subtitle:
        "áƒ›áƒáƒ áƒ—áƒ”áƒ— áƒ’áƒáƒœáƒªáƒ®áƒáƒ“áƒ”áƒ‘áƒ”áƒ‘áƒ˜, áƒ’áƒáƒ›áƒáƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ— áƒžáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ¨áƒ”áƒ˜áƒœáƒáƒ áƒ©áƒ£áƒœáƒ”áƒ— áƒ’áƒ£áƒœáƒ“áƒ˜áƒ¡ áƒ”áƒ áƒ—áƒáƒ‘áƒ áƒáƒ áƒ”áƒœáƒáƒ•áƒáƒœáƒ˜ áƒ’áƒáƒ›áƒáƒªáƒ“áƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ—.",
      cta: "áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ",
      cardTitle: "áƒ‘áƒáƒšáƒ áƒáƒ¥áƒ¢áƒ˜áƒ•áƒáƒ‘áƒ",
      cardBody:
        "áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜ áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ”áƒœ áƒžáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ¡ áƒ“áƒ áƒ›áƒáƒ áƒ—áƒáƒ•áƒ”áƒœ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ¡ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ£áƒšáƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ“áƒáƒœ.",
      adminsLabel: "áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒáƒ“áƒ›áƒ˜áƒœáƒ”áƒ‘áƒ˜",
    },
    posts: {
      title: "áƒ‘áƒáƒšáƒ áƒžáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜",
    },
    footer: {
      description: "áƒ—áƒáƒœáƒáƒ›áƒ”áƒ“áƒ áƒáƒ•áƒ” áƒ°áƒáƒ‘áƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒáƒ”áƒ áƒ—áƒ˜áƒáƒœáƒ”áƒ‘áƒ¡ áƒ’áƒ£áƒœáƒ“áƒ¡ áƒ›áƒ™áƒáƒ¤áƒ˜áƒ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ—.",
      company: "áƒ™áƒáƒ›áƒžáƒáƒœáƒ˜áƒ",
      about: "áƒ©áƒ•áƒ”áƒœ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘",
      careers: "áƒ™áƒáƒ áƒ˜áƒ”áƒ áƒ",
      press: "áƒ›áƒ”áƒ“áƒ˜áƒ",
      resources: "áƒ áƒ”áƒ¡áƒ£áƒ áƒ¡áƒ”áƒ‘áƒ˜",
      blog: "áƒ‘áƒšáƒáƒ’áƒ˜",
      guides: "áƒ’áƒáƒ˜áƒ“áƒ”áƒ‘áƒ˜",
      support: "áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ",
      legal: "áƒ˜áƒ£áƒ áƒ˜áƒ“áƒ˜áƒ£áƒšáƒ˜",
      privacy: "áƒ™áƒáƒœáƒ¤áƒ˜áƒ“áƒ”áƒœáƒªáƒ˜áƒáƒšáƒ£áƒ áƒáƒ‘áƒ",
      terms: "áƒžáƒ˜áƒ áƒáƒ‘áƒ”áƒ‘áƒ˜",
      security: "áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ”áƒ‘áƒ",
      copy: "Â© 2024 SPG Portal. áƒ§áƒ•áƒ”áƒšáƒ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒ“áƒáƒªáƒ£áƒšáƒ˜áƒ.",
      contact: "hello@spg-portal.com",
    },
    adminList: {
      title: "áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒáƒ“áƒ›áƒ˜áƒœáƒ”áƒ‘áƒ˜",
      empty: "áƒáƒ“áƒ›áƒ˜áƒœáƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ. áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ— áƒáƒ“áƒ›áƒ˜áƒœ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ“áƒáƒœ.",
    },
    postsList: {
      empty: "áƒžáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜.",
    },
    meta: {
      addedOn: "áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ",
      postedOn: "áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ",
    },
  },
};

const STORAGE_KEYS = {
  admins: "spg.admins",
  posts: "spg.posts",
  language: "spg.language",
};

const languageButtons = document.querySelectorAll("[data-lang]");
const adminList = document.getElementById("adminList");
const postGrid = document.getElementById("postGrid");
const burger = document.getElementById("burger");
const mobileMenu = document.getElementById("mobile");
const drops = Array.from(document.querySelectorAll(".drop"));
const header = document.getElementById("siteHeader");

const getStored = (key, fallback) => {
  try {
    return JSON.parse(localStorage.getItem(key)) ?? fallback;
  } catch {
    return fallback;
  }
};

const formatDate = (lang, value) => {
  if (!value) {
    return "";
  }
  const date = new Date(value);
  if (Number.isNaN(date.getTime())) {
    return "";
  }
  const locale = lang === "ka" ? "ka-GE" : "en-US";
  return new Intl.DateTimeFormat(locale, { dateStyle: "medium" }).format(date);
};

const setLanguage = (lang) => {
  const dictionary = translations[lang];
  document.documentElement.lang = lang === "ka" ? "ka" : "en";

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const keys = el.dataset.i18n.split(".");
    let value = dictionary;
    keys.forEach((key) => {
      value = value?.[key];
    });
    if (typeof value === "string") {
      el.textContent = value;
    }
  });

  localStorage.setItem(STORAGE_KEYS.language, lang);

  languageButtons.forEach((button) => {
    button.classList.toggle("active", button.dataset.lang === lang);
  });
};

const renderAdmins = (lang) => {
  const admins = getStored(STORAGE_KEYS.admins, []);
  adminList.innerHTML = "";
  if (!admins.length) {
    const empty = document.createElement("p");
    empty.textContent = translations[lang].adminList.empty;
    adminList.appendChild(empty);
    return;
  }
  admins.forEach((admin) => {
    const item = document.createElement("div");
    item.className = "list-item";
    const formatted = formatDate(lang, admin.createdAt);
    const label = formatted
      ? `${translations[lang].meta.addedOn} ${formatted}`
      : translations[lang].meta.addedOn;
    item.innerHTML = `
      <div class="list-meta">
        ${admin.name}
        <span>${admin.email}</span>
      </div>
      <span class="pill">${label}</span>
    `;
    adminList.appendChild(item);
  });
};

const renderPosts = (lang) => {
  const posts = getStored(STORAGE_KEYS.posts, []);
  postGrid.innerHTML = "";
  if (!posts.length) {
    const empty = document.createElement("p");
    empty.textContent = translations[lang].postsList.empty;
    postGrid.appendChild(empty);
    return;
  }
  posts.forEach((post) => {
    const card = document.createElement("article");
    card.className = "post-card";
    const formatted = formatDate(lang, post.createdAt);
    const label = formatted
      ? `${translations[lang].meta.postedOn} ${formatted}`
      : translations[lang].meta.postedOn;
    card.innerHTML = `
      <h3>${post.title}</h3>
      <p>${post.body}</p>
      <span class="pill">${label}</span>
    `;
    postGrid.appendChild(card);
  });
};

const initialize = () => {
  const initialLang = localStorage.getItem(STORAGE_KEYS.language) || "en";
  setLanguage(initialLang);
  renderAdmins(initialLang);
  renderPosts(initialLang);
};

languageButtons.forEach((button) => {
  button.addEventListener("click", () => {
    const next = button.dataset.lang || "en";
    setLanguage(next);
    renderAdmins(next);
    renderPosts(next);
  });
});

burger?.addEventListener("click", () => {
  mobileMenu?.classList.toggle("open");
});

drops.forEach((drop) => {
  const button = drop.querySelector("button");
  button?.addEventListener("click", (event) => {
    event.preventDefault();
    drops.forEach((item) => item !== drop && item.classList.remove("open"));
    drop.classList.toggle("open");
  });
});

document.addEventListener("click", (event) => {
  if (!event.target.closest(".drop")) {
    drops.forEach((drop) => drop.classList.remove("open"));
  }
});

window.addEventListener(
  "scroll",
  () => {
    if (!header) {
      return;
    }
    header.classList.toggle("shrink", window.scrollY > 40);
  },
  { passive: true }
);

initialize();
